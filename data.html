<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="font.css" />
    <link rel="shortcut icon" href="Media/Logo.png" type="image/x-icon" />
    <title>BookShelf - Developed By Kartikeya Rankaushal</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-weight: 500;
        font-family: "Poppins";
      }
      body {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        width: 100%;
        height: 100vh;
      }
      .container {
        position: relative;
        max-width: 700px;
        width: 100%;
        background: #fff;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.337);
      }
      .container header {
        font-size: 1.5rem;
        color: #333;
        font-weight: 500;
        text-align: center;
      }
      .container .form {
        margin-top: 30px;
      }
      .form .input-box {
        width: 100%;
        margin-top: 20px;
      }
      .input-box label {
        color: #333;
      }
      .form :where(.input-box input, .select-box) {
        position: relative;
        height: 50px;
        width: 100%;
        outline: none;
        font-size: 1rem;
        color: #767676;
        margin-top: 8px;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 0 15px;
        font-weight: 400;
      }
      .input-box input:focus {
        box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
      }
      .form .column {
        display: flex;
        column-gap: 15px;
      }

      .form .submit-btn {
        height: 55px;
        width: 100%;
        color: #fff;
        font-size: 1rem;
        font-weight: 400;
        margin-top: 30px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        background: #181818;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .form .submit-btn:hover {
        background: #262626;
      }
    </style>
  </head>
  <body>
    <section class="container">
      <header>Registration Form</header>
      <form
        class="form"
        id="myForm"
        method="post"
        action="https://sheetdb.io/api/v1/wdhyj153fljdv"
      >
        <div class="column">
          <div class="input-box">
            <label> Name</label>
            <input
              type="text"
              id="FirstName"
              name="Name"
              readonly
              class="styled-input"
            />
          </div>

          <div class="input-box">
            <label> Class </label>
            <input
              type="text"
              id="Class"
              name="Class"
              readonly
              class="styled-input"
            />
          </div>
        </div>

        <div class="column">
          <div class="input-box">
            <label id="changesection">Section </label>
            <input
              type="text"
              id="Section"
              name="Section/Stream"
              readonly
              class="styled-input"
            />
          </div>

          <div class="input-box">
            <label>Author </label>
            <input
              type="text"
              id="Authorname"
              name="Author"
              readonly
              class="styled-input"
            />
          </div>
        </div>

        <div class="column">
          <div class="input-box">
            <label> Book </label>
            <input
              type="text"
              id="BookName"
              name="Book"
              readonly
              class="styled-input"
            />
          </div>
        </div>

        <div class="column">
          <div class="input-box">
            <label>Date</label>
            <input
              type="text"
              readonly
              name="Date"
              id="dateInput"
              title="You can't edit this field"
            />
          </div>

          <div class="input-box">
            <label>Due Date </label>
            <input
              type="text"
              id="DueDate"
              name="Return"
              readonly
              title="You can't edit this field"
            />
          </div>

          <div class="input-box">
            <label>Time</label>
            <input
              type="time"
              readonly
              name="Time"
              id="timeInput"
              title="You can't edit this field"
            />
          </div>
        </div>

        <div class="column">
          <input
            type="submit"
            class="submit-btn"
            id="Chnagetext"
            value="Submit"
          />
          <div class="submit-btn" id="Editclickchange" onclick="enableInputs()">
            Edit
          </div>
        </div>
      </form>
    </section>

    <div class="btn-back" id="Goback">Back</div>

    <script>
      function enableInputs() {
        var inputs = document.getElementsByTagName("input");
        for (var i = 0; i < inputs.length; i++) {
          if (
            inputs[i].id !== "dateInput" &&
            inputs[i].id !== "timeInput"
          ) {
            inputs[i].removeAttribute("readonly");
            inputs[i].setAttribute("required", true);
          }
        }
      }

      const buttonedit = document.getElementById("Editclickchange");
      buttonedit.addEventListener("click", function () {
        enableInputs();
        buttonedit.innerHTML = "Edit Enabled";
        const elements = document.querySelectorAll(".styled-input");

        elements.forEach((element) => {
          element.style.border = "1px solid #272727";
          element.style.color = "#272727";
        });
      });
    </script>
    <script>
      var dueDatefuture = localStorage.getItem("DueDate");
      var currentDateTime = new Date();
      var currentDate = currentDateTime.toISOString().split("T")[0];
      var currentTime = currentDateTime.toTimeString().slice(0, 5);
      var today = new Date();

      var after7Days = new Date();
      // Assuming you have the 'dueDate' value obtained from localStorage

      var today = new Date();
      var after7Days = new Date();

      if (dueDatefuture === "1") {
        after7Days.setDate(today.getDate() + 1);
      } else if (dueDatefuture === "2") {
        after7Days.setDate(today.getDate() + 2);
      } else if (dueDatefuture === "3") {
        after7Days.setDate(today.getDate() + 3);
      } else if (dueDatefuture === "4") {
        after7Days.setDate(today.getDate() + 4);
      } else if (dueDatefuture === "5") {
        after7Days.setDate(today.getDate() + 5);
      } else if (dueDatefuture === "6") {
        after7Days.setDate(today.getDate() + 6);
      } else if (dueDatefuture === "7") {
        after7Days.setDate(today.getDate() + 7);
      } else if (dueDatefuture === "14") {
        after7Days.setDate(today.getDate() + 7);
      } else {
        // Handle the case when the selected due date is not within the options
        alert("Solve the error");
      }

      // Now you can use the 'after7Days' variable which represents the calculated due date

      var options = { year: "numeric", month: "long", day: "numeric" };
      var currentDate = today.toLocaleDateString(undefined, options);
      var formattedAfter7Days = after7Days.toLocaleDateString(
        undefined,
        options
      );

      document.getElementById("DueDate").value = formattedAfter7Days;
      document.getElementById("dateInput").value = currentDate;
      document.getElementById("timeInput").value = currentTime;

      const FirstName = localStorage.getItem("name");
      const storedValue = localStorage.getItem("selectedValueclass");
      const SelectedSection = localStorage.getItem("SelectedSection");
      const SelectedSectionLower = localStorage.getItem("SelectedSectionLower");
      const Bookname = localStorage.getItem("bookname");
      const Authorname = localStorage.getItem("Authorname");

      document.getElementById("FirstName").value = FirstName;
      document.getElementById("Class").value = storedValue;
      document.getElementById("BookName").value = Bookname;
      document.getElementById("Authorname").value = Authorname;

      if (storedValue === "11th" || storedValue === "12th") {
        document.getElementById("Section").value = SelectedSection;
      } else {
        document.getElementById("Section").value = SelectedSectionLower;
      }

      // Get the form element by its ID
      const myform = document.getElementById("myForm");

      // Get all the input elements within the form
      const inputs = myform.getElementsByTagName("input");

      // Iterate over the input elements
      for (let i = 0; i < inputs.length; i++) {
        const input = inputs[i];

        // Get the current input value
        const value = input.value;

        // Split the value into an array of words
        const words = value.split(" ");

        // Capitalize the first letter of each word
        const capitalizedWords = words.map((word) => {
          return word.charAt(0).toUpperCase() + word.slice(1);
        });

        // Join the capitalized words back into a single string
        const capitalizedValue = capitalizedWords.join(" ");

        // Update the input value with the capitalized version
        input.value = capitalizedValue;
      }

      // Simplified form submission with async/await and arrow functions
      document
        .getElementById("myForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          try {
            const response = await fetch(e.target.action, {
              method: "POST",
              body: new FormData(e.target),
            });

            if (response.ok) {
              console.log("Form submmited");
            } else {
              console.log("Form not submmited");
            }
          } catch (error) {
            console.log("Error occured");
          }
        });

      // Get the button element
      const button = document.getElementById("Chnagetext");

      // Add a click event listener to the button
      button.addEventListener("click", function () {
        // Check the current text of the button
        button.style.display = "none";

        const buttonedit = document.getElementById("Editclickchange");
        buttonedit.innerHTML = "Submitted";

        document.getElementById("myForm").style.pointerEvents = "none";

        // Redirect after 1 second
        setTimeout(() => {
          redirectToIndex();
        }, 10);
      });

      function redirectToIndex() {
        let countdown = 5;

        const countdownInterval = setInterval(() => {
          countdown--;
          document.getElementById("Editclickchange").innerHTML =
            "Redirecting in " + countdown + " seconds...";

          if (countdown === 0) {
            clearInterval(countdownInterval);
            window.location.href = "note.html";
          }
        }, 1000);
      }
    </script>

    <script>
      // Load existing data from local storage on page load
      window.addEventListener("load", function () {
        var data = JSON.parse(localStorage.getItem("formData"));
        if (data) {
          data.forEach(function (item) {
            if (
              (item.Class === "5th" &&
                window.location.href.indexOf("Issued/5th.html") > -1) ||
              (item.Class === "6th" &&
                window.location.href.indexOf("Issued/6th.html") > -1) ||
              (item.Class === "7th" &&
                window.location.href.indexOf("Issued/7th.html") > -1) ||
              (item.Class === "8th" &&
                window.location.href.indexOf("Issued/8th.html") > -1) ||
              (item.Class === "9th" &&
                window.location.href.indexOf("Issued/9th.html") > -1) ||
              (item.Class === "10th" &&
                window.location.href.indexOf("Issued/10th.html") > -1) ||
              (item.Class === "11th" &&
                window.location.href.indexOf("Issued/11th.html") > -1) ||
              (item.Class === "12th" &&
                window.location.href.indexOf("Issued/12th.html") > -1)
            ) {
              addRowToTable(
                item.FirstName,
                item.Class,
                item.Section,
                item.BookName,
                item.Authorname,
                item.dateInput,
                item.DueDate,
                item.timeInput
              );
            }
          });
        }
      });

      document
        .getElementById("myForm")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the form from submitting

          // Get form values
          var FirstName = document.getElementById("FirstName").value;
          var Class = document.getElementById("Class").value;
          var Section = document.getElementById("Section").value;
          var BookName = document.getElementById("BookName").value;
          var Authorname = document.getElementById("Authorname").value;
          var dateInput = document.getElementById("dateInput").value;
          var timeInput = document.getElementById("timeInput").value;
          var DueDate = document.getElementById("DueDate").value;

          // Check if any field is empty
          if (
            FirstName === "" ||
            Class === "" ||
            Section === "" ||
            BookName === "" ||
            Authorname === "" ||
            dateInput === "" ||
            timeInput === "" ||
            DueDate === ""
          ) {
            alert("Please fill in all fields.");
            return;
          }

          // Save form data to local storage
          var formData = JSON.parse(localStorage.getItem("formData")) || [];
          formData.push({
            FirstName: FirstName,
            Class: Class,
            Section: Section,
            BookName: BookName,
            Authorname: Authorname,
            dateInput: dateInput,
            timeInput: timeInput,
            DueDate: DueDate,

            // FirstName: "John",
            // Class: "10th",
            // Section: "1",
            // BookName: "JavaScript Book",
            // Authorname: "John Smith",
            // dateInput: "July 27, 2023",
            // DueDate: "July 27, 2023",
            // timeInput: "21:35",
          });
          localStorage.setItem("formData", JSON.stringify(formData));

          // Add row to the table if the page matches the class number
          if (
            (Class === "5th" &&
              window.location.href.indexOf("Issued/5th.html") > -1) ||
            (Class === "6th" &&
              window.location.href.indexOf("Issued/6th.html") > -1) ||
            (Class === "7th" &&
              window.location.href.indexOf("Issued/7th.html") > -1) ||
            (Class === "8th" &&
              window.location.href.indexOf("Issued/8th.html") > -1) ||
            (Class === "9th" &&
              window.location.href.indexOf("Issued/9th.html") > -1) ||
            (Class === "10th" &&
              window.location.href.indexOf("Issued/10th.html") > -1) ||
            (Class === "11th" &&
              window.location.href.indexOf("Issued/11th.html") > -1) ||
            (Class === "12th" &&
              window.location.href.indexOf("Issued/12th.html") > -1)
          ) {
            addRowToTable(
              FirstName,
              Class,
              Section,
              BookName,
              Authorname,
              dateInput,
              DueDate,
              timeInput
            );
          }
        });
    </script>
  <script>
 function getCurrentDate() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function resetClickCountIfNeeded() {
      const lastDate = localStorage.getItem('lastDate');
      const currentDate = getCurrentDate();

      if (currentDate !== lastDate) {
        localStorage.setItem('clickCount', 0);
        localStorage.setItem('lastDate', currentDate);
        console.log("New day! Click count reset to 0.");
      }
    }

    function collectButtonClick() {
      resetClickCountIfNeeded();

      let clickCount = localStorage.getItem('clickCount') || 0;
      clickCount = parseInt(clickCount, 10) + 1;

      localStorage.setItem('clickCount', clickCount);
      console.log(`Number of clicks today: ${clickCount}`);
    }

    document.getElementById('Chnagetext').addEventListener('click', collectButtonClick);

    // Check for a new day every 1 minute (adjust the interval as needed)
    setInterval(resetClickCountIfNeeded, 60000);
  </script>

  </script>
    <script>
      var classselected = document.getElementById("Class").value;
      if (classselected === "11th" || classselected === "12th") {
        document.getElementById("changesection").innerText = "Stream";
      }
    </script>

    <script src="script.js"></script>
  </body>
</html>
